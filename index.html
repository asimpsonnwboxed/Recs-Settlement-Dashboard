<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recs & Settlement Weekly Update</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.10.3/umd/Recharts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.378.0/dist/umd/lucide.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #f8fafc; margin: 0; font-family: sans-serif; }
        .recharts-default-tooltip { border-radius: 12px !important; border: none !important; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1) !important; padding: 12px !important; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        #root { min-height: 100vh; display: flex; flex-direction: column; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Safe destructuring of Recharts components
        const { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, 
            LineChart, Line, ComposedChart, Legend, ReferenceLine
        } = window.Recharts || {};

        const Icon = ({ name, color = "currentColor", size = 20, className = "" }) => {
            const ref = React.useRef(null);
            React.useEffect(() => {
                if (ref.current && window.lucide) {
                    ref.current.innerHTML = `<i data-lucide="${name}"></i>`;
                    window.lucide.createIcons({
                        attrs: { stroke: color, 'stroke-width': 2.5, width: size, height: size }
                    });
                }
            }, [name, color, size]);
            return <span ref={ref} className={`${className} inline-flex items-center justify-center`} />;
        };

        const App = () => {
            // Data for Week Ending 30 Jan 2026 (Mon-Fri) 
            const combinedDailyData = [
                { date: 'Mon 26', trans: 130175, settled: -4338761.71 },
                { date: 'Tue 27', trans: 57481, settled: -828844.92 },
                { date: 'Wed 28', trans: 62961, settled: -2007409.76 },
                { date: 'Thu 29', trans: 63158, settled: -976006.92 },
                { date: 'Fri 30', trans: 93452, settled: -222345.23 },
            ];

            const schemePerformance = [
                { name: 'Combined FPS', transactions: 407227, settled: -8373368.54, colour: '#3b82f6', icon: 'zap', change: '+14.7%', amountDiff: '+52k', volChange: 'up' },
                { name: 'Combined BACS', transactions: 47379, settled: 25220050.46, colour: '#8b5cf6', icon: 'landmark', change: '-1.3%', amountDiff: '-Â£10.6M', volChange: 'down' },
                { name: 'Mettle Cards', transactions: 307325, settled: -17482540.42, colour: '#6366f1', icon: 'credit-card', change: '+1.1%', amountDiff: '+3.5k', volChange: 'up' },
                { name: 'Mettle Cash', transactions: 2318, settled: 686582.77, colour: '#10b981', icon: 'banknote', change: '+18.9%', amountDiff: '+369', volChange: 'up' },
            ];

            const clientData = [
                {
                    client: 'Mettle',
                    totalTrans: 759765,
                    totalValue: -7201441.61,
                    accent: '#3b82f6',
                    recsStatus: 'Reconciled',
                    schemes: [
                        { name: 'FPS', trans: 404603, value: -15105073.99, colour: '#3b82f6' },
                        { name: 'BACS', trans: 45519, value: 24699590.03, colour: '#8b5cf6' },
                        { name: 'Cards', trans: 307325, value: -17482540.42, colour: '#6366f1' },
                        { name: 'Cash', trans: 2318, value: 686582.77, colour: '#10b981' },
                    ],
                    commentary: "Card expenditure reached month-end peaks. Inbound liquidity remains extremely robust, ensuring full settlement coverage. ðŸ“ˆ"
                },
                {
                    client: 'The AA',
                    totalTrans: 2689,
                    totalValue: -6736539.90,
                    accent: '#f59e0b',
                    recsStatus: 'Investigating',
                    schemes: [
                        { name: 'FPS (Lending)', trans: 609, value: -8682643, colour: '#f59e0b' },
                        { name: 'FPS (Savings)', trans: 220, value: 1425642.67, colour: '#fbbf24' },
                        { name: 'BACS (Combined)', trans: 1860, value: 520460.43, colour: '#d97706' },
                    ],
                    commentary: "Lending disbursements reached Â£8.68M. Monitoring two active investigations related to scheme returns and DDIC processing. ðŸš€"
                },
                {
                    client: 'SAGA',
                    totalTrans: 1795,
                    totalValue: 13988705.78,
                    accent: '#ec4899',
                    recsStatus: 'Reconciled',
                    schemes: [
                        { name: 'FPS', trans: 1795, value: 13988705.78, colour: '#ec4899' },
                    ],
                    commentary: "SAGA scaling continues to break records, with nearly Â£14M processed this week. All positions matched scheme data seamlessly. ðŸš€"
                },
                {
                    client: 'NW Retail & Dragenox',
                    totalTrans: 0,
                    totalValue: 0,
                    accent: '#64748b',
                    recsStatus: 'Reconciled',
                    schemes: [
                        { name: 'Retail FPS', trans: 0, value: 0, colour: '#64748b' },
                        { name: 'Dragenox FPS', trans: 0, value: 0, colour: '#94a3b8' },
                    ],
                    commentary: "Both portfolios remained static during this period. Ledgers verified as stable and reconciled. âœ…"
                }
            ];

            const formatCurrency = (val) => {
                const absVal = Math.abs(val);
                const useDecimals = absVal > 0 && absVal < 1;
                return new Intl.NumberFormat('en-GB', { 
                    style: 'currency', 
                    currency: 'GBP', 
                    maximumFractionDigits: useDecimals ? 2 : 0,
                    minimumFractionDigits: useDecimals ? 2 : 0
                }).format(val);
            };

            const maxVal = Math.max(...combinedDailyData.map(d => d.settled), 0);
            const minVal = Math.min(...combinedDailyData.map(d => d.settled), 0);
            const offset = maxVal / (maxVal - minVal);

            return (
                <div className="min-h-screen bg-[#f8fafc] font-sans text-slate-900 flex flex-col w-full overflow-x-hidden p-4 lg:p-6">
                    {/* Header */}
                    <div className="w-full bg-white border border-slate-200 rounded-2xl px-6 py-4 flex items-center justify-between shadow-sm mb-6">
                        <div className="flex items-center gap-4">
                            <div className="p-2.5 bg-[#002d72] rounded-xl text-white shadow-md shadow-blue-900/20">
                                <Icon name="globe" color="white" size={24} />
                            </div>
                            <div>
                                <h1 className="text-xl font-black text-slate-900 tracking-tight uppercase leading-none">
                                    NatWest Boxed <span className="text-slate-300 font-normal mx-1">|</span> <span className="text-[#002d72]">Recs & Settlement</span>
                                </h1>
                                <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Week Ending 30 January 2026</p>
                            </div>
                        </div>
                        <div className="flex items-center gap-2 bg-amber-50 text-amber-700 px-3 py-1.5 rounded-full border border-amber-200">
                            <div className="h-1.5 w-1.5 bg-amber-500 rounded-full animate-pulse"></div>
                            <span className="text-[10px] font-black uppercase tracking-wider">Active Breaks Pending</span>
                        </div>
                    </div>

                    <div className="flex-1 space-y-6 w-full max-w-[1600px] mx-auto flex flex-col">
                        <div className="grid grid-cols-1 xl:grid-cols-12 gap-6">
                            
                            {/* LHS - Metrics, Chart & Operational Context */}
                            <div className="xl:col-span-8 flex flex-col gap-6">
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                    {schemePerformance.map((scheme, idx) => (
                                        <div key={idx} className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-between transition-all hover:ring-2 hover:ring-blue-500/10">
                                            <div className="flex justify-between items-center mb-3">
                                                <p className="text-[9px] font-black text-slate-400 uppercase tracking-widest">{scheme.name}</p>
                                                <div className="p-1.5 rounded-lg" style={{ backgroundColor: `${scheme.colour}10` }}>
                                                    <Icon name={scheme.icon} color={scheme.colour} size={16} />
                                                </div>
                                            </div>
                                            <div className="space-y-3">
                                                <div className="flex items-center justify-between">
                                                    <h3 className="text-xl font-black text-slate-800 tabular-nums leading-none tracking-tight">
                                                        {scheme.transactions.toLocaleString()}
                                                    </h3>
                                                    <div className={`flex flex-col items-end text-[9px] font-black ${scheme.volChange === 'up' ? 'text-emerald-500' : 'text-rose-500'}`}>
                                                        <div className="flex items-center">
                                                            <Icon name={scheme.volChange === 'up' ? 'arrow-up' : 'arrow-down'} color="currentColor" size={10} className="mr-0.5" />
                                                            {scheme.change}
                                                        </div>
                                                        <span className="text-[8px] opacity-70">{scheme.amountDiff} vol.</span>
                                                    </div>
                                                </div>
                                                <div className="pt-2 border-t border-slate-50 flex items-center justify-between">
                                                    <span className="text-[9px] font-black text-emerald-500 uppercase tracking-tighter">Reconciled</span>
                                                    <h3 className={`text-sm font-black tabular-nums leading-none ${scheme.settled < 0 ? 'text-rose-600' : 'text-emerald-600'}`}>
                                                        {formatCurrency(scheme.settled)}
                                                    </h3>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 transition-all">
                                    <div className="mb-6 flex justify-between items-end border-b border-slate-100 pb-4">
                                        <div>
                                            <h3 className="text-lg font-black text-slate-800 flex items-center gap-2">
                                                <Icon name="activity" color="#002d72" size={20} /> Daily Settlement Profile
                                            </h3>
                                            <p className="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-0.5">Aggregated Flow across Portfolios</p>
                                        </div>
                                        <div className="flex gap-4 text-[10px] font-black uppercase tracking-widest text-slate-900">
                                            <div className="flex items-center gap-1.5"><div className="h-2.5 w-2.5 bg-slate-300 rounded-full"></div> Vol.</div>
                                            <div className="flex items-center gap-1.5"><div className="h-2.5 w-2.5 bg-[#ef4444] rounded-full"></div> Settlement (Debit)</div>
                                        </div>
                                    </div>
                                    <div className="h-[320px] pt-4">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <ComposedChart data={combinedDailyData} margin={{ top: 10, right: 30, left: -10, bottom: 0 }}>
                                                <defs>
                                                    <linearGradient id="splitColor" x1="0" y1="0" x2="0" y2="1">
                                                        <stop offset={offset} stopColor="#10b981" stopOpacity={1} />
                                                        <stop offset={offset} stopColor="#ef4444" stopOpacity={1} />
                                                    </linearGradient>
                                                </defs>
                                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                                <XAxis dataKey="date" axisLine={false} tickLine={false} tick={{fill: '#0f172a', fontSize: 11, fontWeight: 800}} dy={12} />
                                                <YAxis yAxisId="left" axisLine={false} tickLine={false} tick={{fill: '#0f172a', fontSize: 11, fontWeight: 700}} />
                                                <YAxis yAxisId="right" orientation="right" axisLine={false} tickLine={false} tick={{fill: '#0f172a', fontSize: 11, fontWeight: 700}} tickFormatter={(value) => `Â£${Math.round(value/1000000)}M`} />
                                                <Tooltip 
                                                    cursor={{ fill: '#f1f5f9' }} 
                                                    contentStyle={{borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgb(0 0 0 / 0.1)'}}
                                                    labelStyle={{ fontWeight: 'black', marginBottom: '4px' }}
                                                    itemStyle={{ fontWeight: 'bold', fontSize: '12px' }}
                                                    formatter={(value, name) => [
                                                        <span style={{ color: name === 'Settled' ? (value < 0 ? '#ef4444' : '#10b981') : '#64748b' }}>
                                                            {name === 'Settled' ? formatCurrency(value) : value.toLocaleString()}
                                                        </span>, 
                                                        name
                                                    ]} 
                                                />
                                                <ReferenceLine yAxisId="right" y={0} stroke="#0f172a" strokeWidth={2} label={{ position: 'right', value: '0', fill: '#000', fontSize: 12, fontWeight: 900 }} />
                                                <Bar yAxisId="left" dataKey="trans" name="Transactions" fill="#cbd5e1" radius={[6, 6, 0, 0]} barSize={40} />
                                                <Line 
                                                    yAxisId="right" 
                                                    type="monotone" 
                                                    dataKey="settled" 
                                                    name="Settled" 
                                                    stroke="url(#splitColor)" 
                                                    strokeWidth={5} 
                                                    dot={(props) => {
                                                        const { cx, cy, value } = props;
                                                        return (
                                                            <circle 
                                                                cx={cx} cy={cy} r={6} 
                                                                fill={value < 0 ? "#ef4444" : "#10b981"} 
                                                                stroke="#fff" strokeWidth={2} 
                                                            />
                                                        );
                                                    }}
                                                />
                                            </ComposedChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>

                                {/* Operational Context (Moved from Sidebar) */}
                                <div className="bg-slate-50 border border-slate-200 p-6 rounded-2xl flex-1">
                                    <h4 className="text-[10px] font-black text-slate-400 uppercase tracking-widest border-b border-slate-200 pb-3 mb-4 flex items-center gap-2">
                                        <Icon name="message-square" color="#94a3b8" size={14} /> Operational Summary & Insights
                                    </h4>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {[
                                            { tag: 'SAGA SCALING', text: "Record month-end scaling reached nearly Â£14M this week. This significant volume increase was managed through standard daily processing windows without any discrepancies identified between internal system records and scheme reporting. âœ…" },
                                            { tag: 'AA DISBURSEMENTS', text: "Lending disbursements remained high at Â£8.68M across 609 unique payouts. The operations team conducted manual validation of these high-value outflows to ensure 100% auditability and settlement accuracy. ðŸš€" },
                                            { tag: 'METTLE LIQUIDITY', text: "Peak card expenditure reached -Â£17.48M during the month-end cycle. This was successfully supported by robust BACS liquidity inflows. Daily reconciliation was prioritised to ensure the net-outflow position remained within agreed limits. ðŸ“ˆ" },
                                            { tag: 'STATIC PORTFOLIOS', text: "The NatWest Retail and Dragenox portfolios were closely monitored throughout the weekly cycle; however, no transaction activity was recorded. All static balances have been verified as fully reconciled. âœ…" }
                                        ].map((item, i) => (
                                            <div key={i} className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col gap-1.5">
                                                <span className="text-[#002d72] font-black uppercase text-[10px] tracking-wider">{item.tag}</span>
                                                <p className="text-[11px] font-medium text-slate-600 leading-relaxed">{item.text}</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* RHS - Detailed Sidebar */}
                            <div className="xl:col-span-4 flex flex-col gap-6">
                                <div className="bg-[#002d72] text-white p-6 rounded-2xl shadow-lg border border-blue-900 flex-1 flex flex-col">
                                    <h4 className="text-[10px] font-black text-blue-300 uppercase tracking-widest mb-4 flex items-center gap-2">
                                        <Icon name="info" color="#93c5fd" size={16} /> Detailed Rec Breaks Tracker
                                    </h4>
                                    <div className="space-y-4 overflow-y-auto pr-2 hide-scrollbar flex-1">
                                        
                                        <div className="pb-3 border-b border-blue-800/50">
                                            <p className="text-[9px] font-black text-rose-400 uppercase tracking-widest mb-2 underline">Active Investigations (Open)</p>
                                            <div className="space-y-3 text-[11px]">
                                                <div className="bg-blue-800/30 p-2.5 rounded-lg border border-blue-700/50">
                                                    <div className="flex justify-between items-start mb-1">
                                                        <p className="font-black text-white">POB-550 | AA FPS | Â£1,000</p>
                                                        <span className="bg-rose-500 text-[8px] px-1 rounded text-white font-bold uppercase tracking-tighter">Open</span>
                                                    </div>
                                                    <p className="text-blue-100 leading-tight mb-1.5 font-medium italic">"Return of a return" logic mismatch.</p>
                                                    <p className="text-[10px] text-blue-200 leading-tight">Discrepancy identified in AA settlement account balance. Engineering teams are investigating a specific sequence of returns; we are maintaining the break due to a Â£1,000 variance remaining after all daily cycles completed.</p>
                                                </div>
                                                <div className="bg-blue-800/30 p-2.5 rounded-lg border border-blue-700/50">
                                                    <div className="flex justify-between items-start mb-1">
                                                        <p className="font-black text-white">POB-547 | AA BACS | Â£584.38</p>
                                                        <span className="bg-rose-500 text-[8px] px-1 rounded text-white font-bold uppercase tracking-tighter">Open</span>
                                                    </div>
                                                    <p className="text-blue-100 leading-tight mb-1.5 font-medium italic">DDIC Challenge Settlement Failure.</p>
                                                    <p className="text-[10px] text-blue-200 leading-tight">Two Â£292.19 direct debit indemnity claims (DDICs) were formally challenged but proceeded to settle. Corresponding account debits were not initiated, resulting in an imbalance on the AA DDIC suspense ledger.</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="pb-3">
                                            <p className="text-[9px] font-black text-emerald-400 uppercase tracking-widest mb-2 underline">Successfully Resolved</p>
                                            <div className="space-y-3 text-[11px]">
                                                <div className="bg-blue-800/20 p-2 rounded-lg border border-blue-700/30 opacity-70">
                                                    <div className="flex justify-between items-start mb-1">
                                                        <p className="font-black text-slate-300">POB-554 | Mettle FPS | Â£2,525</p>
                                                        <span className="bg-emerald-500 text-[8px] px-1 rounded text-white font-bold uppercase tracking-tighter">Closed</span>
                                                    </div>
                                                    <p className="text-[10px] text-slate-400 leading-tight">Six Standing Order delays confirmed as a soft break following a transient system incident. All transactions were verified as accounted for and fully reconciled on 27/01.</p>
                                                </div>
                                                <div className="bg-blue-800/20 p-2 rounded-lg border border-blue-700/30 opacity-70">
                                                    <div className="flex justify-between items-start mb-1">
                                                        <p className="font-black text-slate-300">POB-553 | NW Boxed | Â£306.18</p>
                                                        <span className="bg-emerald-500 text-[8px] px-1 rounded text-white font-bold uppercase tracking-tighter">Closed</span>
                                                    </div>
                                                    <p className="text-[10px] text-slate-400 leading-tight">Mismatched entry caused by a timing delay. Discrepancy was resolved through a manual adjustment to the customer loan repayment suspense account on 29/01.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="mt-4 pt-4 border-t border-blue-800/50 flex items-center justify-between text-blue-300 italic">
                                        <span className="text-[9px] font-bold uppercase tracking-widest">Awaiting Engineering Updates</span>
                                        <Icon name="clock" color="#f59e0b" size={14} />
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Section 3 - Client Summary Cards */}
                        <div className="space-y-4 pb-8 w-full mt-6">
                            <h3 className="text-lg font-black text-slate-800 flex items-center gap-2 mb-2 uppercase tracking-wider">
                                <Icon name="users" color="#f59e0b" size={20} /> Client Performance Breakdown
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                {clientData.map((client, idx) => (
                                    <div key={idx} className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col hover:shadow-md transition-all group">
                                        <div className="p-5 border-b border-slate-50 relative" style={{ backgroundColor: `${client.accent}08` }}>
                                            <div className="flex justify-between items-start">
                                                <h4 className="text-lg font-black text-slate-900 tracking-tighter uppercase">{client.client}</h4>
                                                <div className={`h-1.5 w-1.5 rounded-full ${client.recsStatus === 'Reconciled' ? 'bg-emerald-500' : 'bg-amber-500 animate-pulse'}`}></div>
                                            </div>
                                            <div className="flex items-center justify-between mt-4">
                                                <div>
                                                    <p className="text-[8px] font-bold text-slate-400 uppercase tracking-widest">Transactions</p>
                                                    <p className="text-sm font-black text-slate-800 tabular-nums">{client.totalTrans.toLocaleString()}</p>
                                                </div>
                                                <div className="text-right">
                                                    <p className="text-[8px] font-bold text-slate-400 uppercase tracking-widest">Total Value</p>
                                                    <p className={`text-sm font-black tabular-nums ${client.totalValue < 0 ? 'text-rose-500' : 'text-emerald-500'}`}>
                                                        {formatCurrency(client.totalValue)}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="p-5 space-y-2.5 flex-grow bg-white">
                                            {client.schemes.map((scheme, sIdx) => (
                                                <div key={sIdx} className="flex items-center justify-between p-1.5 rounded-lg hover:bg-slate-50 transition-colors">
                                                    <div className="flex items-center gap-2 text-[10px] font-bold text-slate-600 uppercase tracking-tight">
                                                        <div className="h-1.5 w-1.5 rounded-full" style={{ backgroundColor: scheme.colour }}></div>
                                                        {scheme.name}
                                                    </div>
                                                    <p className={`text-[10px] font-black ${scheme.value < 0 ? 'text-rose-500' : 'text-emerald-600'}`}>
                                                        {formatCurrency(scheme.value)}
                                                    </p>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="p-4 bg-slate-50/80 border-t border-slate-100 min-h-[80px] flex items-center">
                                            <p className="text-[10px] text-slate-500 leading-relaxed font-semibold italic text-center w-full">
                                                "{client.commentary}"
                                            </p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            <div className="w-full text-center pt-4 opacity-40">
                                <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest italic text-center underline">Goals for 2026: Scaling Safely & Automating Manual Touchpoints</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
